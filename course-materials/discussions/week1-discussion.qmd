---
title: "Week 1: Discussion Section"
subtitle: "Making maps with `tmap` and beyond"
author: "Alessandra Vidal Meza"
date: last-modified
execute: 
  eval: false
format:
  html:
    toc: true
---

:::{.callout-tip icon=true}
## Reference

Refer to the [Plotting Geospatial Data](./resources/plotting.qmd) resource and [tmap book](https://r-tmap.github.io/tmap-book/) to help get you started.
:::

## Learning Objectives

-   Read in spatial objects
-   Create map with single spatial object
-   Create map with multiple spatial objects
-   Use different types of `tmap` plotting formats (e.g. `tm_polygons()`, `tm_fill()`, `tm_dots()`, etc.)
-   Adjust color palettes
-   Include essential map elements (e.g. scale bar & north arrow or graticules)
-   Create an interactive map
-   **Bonus Challenge**: Reproduce map using `ggplot2` instead of `tmap`

## Get Started

Let's load the necessary packages:

```{r}
#| message: false
#| warning: false

library(here)
library(tidyverse)
library(stars)
library(sf)
library(tmap)
```

And read in the spatial objects for Easter Island (Rapa Nui/Isla de Pascua):

-   `ei_points`: file contains several points on the island
-   `ei_elev`: raster with elevation data
-   `ei_borders`: polygon with the island outline
-   `ei_roads`: lines contains a road network for the island

```{r}
#| eval: false
#| echo: false

ei_points <- sf::read_sf(here::here("course-materials", "data", "week1", "easter_island", "ei_points.gpkg"))
volcanoes <- subset(ei_points, type == "volcano")
ei_elev <- stars::read_stars(here::here("course-materials", "data", "week1", "easter_island", "ei_elev.tif"))
ei_borders <- sf::read_sf(here::here("course-materials", "data", "week1", "easter_island", "ei_border.gpkg"))
ei_roads <- sf::read_sf(here::here("course-materials", "data", "week1", "easter_island", "ei_roads.gpkg"))
```

```{r}
#| eval: false

ei_points <- sf::read_sf(here::here("data", "week1", "easter_island", "ei_points.gpkg"))
volcanoes <- subset(ei_points, type == "volcano")
ei_elev <- stars::read_stars(here::here("data", "week1", "easter_island", "ei_elev.tif"))
ei_borders <- sf::read_sf(here::here("data", "week1", "easter_island", "ei_border.gpkg"))
ei_roads <- sf::read_sf(here::here("data", "week1", "easter_island", "ei_roads.gpkg"))
```

Now, to meet our learning objectives, your task:

1.  Create a map of Easter Island
2.  Create a map of Easter Island and...

-   ...denote the island's borders and continuous elevation
-   ...denote the island's volcanoes and roads
-   ...play with the color palette and essential map elements

3.  Create an interactive map of Easter Island

## Answer Key

### Create a Map of Easter Island with `tmap`
```{r}
#| message: false
#| warning: false
#| eval: false

tm_shape(ei_elev) +
  tm_raster(style = "cont",
            palette = "-RdYlGn",
            title = "Elevation (m asl)") +
  tm_shape(ei_borders) + 
  tm_borders() +
  tm_shape(ei_roads) + 
  tm_lines(lwd = "strokelwd", 
           legend.lwd.show = FALSE) +
  tm_shape(volcanoes) +
  tm_symbols(shape = 24, 
             size = "elevation",
             title.size = "Volcanoes (m asl)") +
  tm_layout(main.title = "Easter Island",
            bg.color = "lightblue") +
  tm_scale_bar(position = c("left", "bottom")) +
  tm_compass(show.labels = 1)
```

```{r}
#| include: false
#| eval: false

# tmap version 3.9:
# tm_shape(ei_elev) +
#   tm_graticules() +
#   tm_raster(col.scale = tm_scale_continuous(),
#             col.legend = tm_legend("Elevation (m asl)")) +
#   tm_scale_continuous("rd_yl_gn") +
#   tm_shape(ei_borders) + 
#   tm_borders() +
#   tm_shape(ei_roads) +
#   tm_lines() +
#   tm_shape(volcanoes) +
#   tm_symbols(shape = 24, size = "elevation", 
#              size.legend = tm_legend("Volcanoes (m asl)")) +
#   tm_compass(position = c("right", "top")) +
#   tm_scalebar() +
#   tm_title("Easter Island")
```

### Create an Interactive Map of Easter Island with `tmap`
```{r}
#| message: false
#| warning: false
#| eval: false

ei_map <- tm_shape(ei_elev) +
          tm_raster(style = "cont",
                    palette = "-RdYlGn",
                    title = "Elevation (m asl)") +
          tm_shape(ei_borders) + 
          tm_borders() +
          tm_shape(ei_roads) + 
          tm_lines(lwd = "strokelwd", 
                   legend.lwd.show = FALSE) +
          tm_shape(volcanoes) +
          tm_symbols(shape = 24, 
                     size = "elevation",
                     title.size = "Volcanoes (m asl)") +
          tm_layout(main.title = "Easter Island",
                    bg.color = "lightblue") +
          tm_scale_bar(position = c("left", "bottom")) +
          tm_compass(show.labels = 1)

tmap_mode("view")
ei_map
```

```{r}
#| include: false
#| eval: false

# tmap version 3.9:
# my_map <- tm_shape(ei_elev) +
#   tm_raster(col.scale = tm_scale_continuous(),
#             col.legend = tm_legend("Elevation (m asl)")) +
#   tm_scale_continuous("rd_yl_gn") +
#   tm_shape(ei_borders) + 
#   tm_borders() +
#   tm_shape(ei_roads) +
#   tm_lines() +
#   tm_shape(volcanoes) +
#   tm_symbols(shape = 24, size = "elevation", 
#              size.legend = tm_legend("Volcanoes (m asl)")) +
#   tm_title("Easter Island")
```

### Create a Map of Easter Island with `ggplot2`
```{r}
#| message: false
#| warning: false
#| eval: false

volcanoes_point <- volcanoes %>%
  mutate(lon = unlist(map(volcanoes$geom,1)),
         lat = unlist(map(volcanoes$geom,2)))

ggplot() +
  geom_sf(data = ei_borders, color = "#212529") +
  geom_stars(data = ei_elev) +
  scale_fill_distiller(name = "Elevation (m asl)",
                       palette = "RdYlGn", na.value = "transparent") +
  geom_sf(data = ei_roads, color = "#343a40") +
    geom_point(data = volcanoes_point, 
             aes(x = lon, y = lat, size = elevation), 
             shape = 17, color = "#22577a") +
  scale_size_continuous(name = "Volcanoes (m asl)") +
  ggspatial::annotation_north_arrow(location = "tr", which_north = "true") +
  ggspatial::annotation_scale(location = "br", width_hint = 0.5) +
  labs(title = "Easter Island") +
  theme_minimal()
```


