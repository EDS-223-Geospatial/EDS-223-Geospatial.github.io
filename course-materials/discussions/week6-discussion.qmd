---
title: "Week 6: Discussion Section"
subtitle: "Working with false color images"
author: "Alessandra Vidal Meza"
date: last-modified
execute: 
  eval: false
format:
  html:
    toc: true
---

::: {.callout-note icon=true}
# Source Materials
The following materials are modified from curriculum developed by [Earth Lab](https://www.earthdatascience.org/courses/earth-analytics/multispectral-remote-sensing-data/naip-imagery-raster-stacks-in-r/#multispectral-imagery-in-r) and the [Raster Analysis with `terra`](https://www.wvview.org/os_sa/15b_Raster_Analysis_terra.html#image-analysis) book.
:::

## 1. Background

In [Lab #6](https://eds-223-geospatial.github.io/course-materials/labs/week6.html), you explored various band combinations and plotted false color images with `tm_rgb()` from `{tmap}`. False color images allow you to visually highlight specific features in an image that may otherwise not be readily discernible. To add to your toolbelt, you will now be plotting false color images with `plotRGB()` from `{terra}`.

The `plotRGB()` function allows you to apply a stretch to normalize the colors in an image. You can either apply a linear stretch or histogram equalization. A linear stretch distributes the values across the entire histogram range defined by the max/min lower bounds of the original raster. A histogram equalization stretches dense parts of the histogram and condenses sparse parts.

But why would you want to normalize the colors in an image?

::: {layout-ncol=2}
![](images/raster-image-stretch-dark.jpg)

![](images/raster-image-stretch-light.jpg)
:::

> "When the range of pixel brightness values is closer to 0, a darker image is rendered by default. You can stretch the values to extend to the full 0-255 range of potential values to increase the visual contrast of the image. When the range of pixel brightness values is closer to 255, a lighter image is rendered by default. You can stretch the values to extend to the full 0-255 range of potential values to increase the visual contrast of the image."

## 2. Get Started

- Create an `.Rproj` as your version controlled project for Week 6
- Create a Quarto document inside your `.Rproj`
- Download [this data folder from Google Drive](https://drive.google.com/file/d/1cgSB6xU6OKK1uMWoiPy_nVIHUrRVJAil/view) and move it inside your `.Rproj`
- Load all necessary packages, read spatial objects, and define `nbr_fun` function

```{r}
library(tidyverse)
library(sf)
library(terra)
```

```{r}
# Set directory for folder
pre_fire_dir <- here::here("data", "landsat", "LC80340322016189-SC20170128091153", "crop")

# Create a list of all images that have the extension .tif and contain the word band
pre_fire_bands <- list.files(pre_fire_dir,
                             pattern = glob2rx("*band*.tif$"),
                             full.names = TRUE)
# Create a raster stack
pre_fire_rast <- rast(pre_fire_bands)
```

```{r}
# Set directory for folder
post_fire_dir <- here::here("data", "landsat", "LC80340322016205-SC20170127160728", "crop")

# Create a list of all images that have the extension .tif and contain the word band
post_fire_bands <- list.files(post_fire_dir,
                             pattern = glob2rx("*band*.tif$"),
                             full.names = TRUE)
# Create a raster stack
post_fire_rast <- rast(post_fire_bands)
```

```{r}
nbr_fun <- function(nir, swir){
    (nir - swir)/(nir + swir)
}
```

## 3. Your Task

Now, to meet this week's learning objectives, your task:

1. Rename the bands of the `pre_fire` and `post_fire` rasters using `names()`

Next, for each of the `pre_fire` and `post_fire` rasters...

2. Plot a true color composite using `plotRGB()` 
3. Plot two false color composite using `plotRGB()`
  - Map the near infrared (NIR) band to the red channel, red to green, and green to blue
  - Apply a linear stretch `“lin”` or histogram equalization `“hist”`
4. Calculate the normalized burn ratio (NBR)
  - **Hint**: Use `lapp()` like you previously did for NDVI and NDWI in [Week 4](https://eds-223-geospatial.github.io/course-materials/discussions/answer-keys/week4-discussion-answerKey.html#find-correlation-between-ndwi-and-ndvi)

Let's bring it home!

5. Find the difference NBR, where $dNBR = prefireNBR - postfireNBR$
6. Plot the `dnBR` raster! Was your false color composite a good exploratory test?